# RAG ç¬¬ä¸€æ€§åŸç†èˆ‡ç³»çµ±æ¼”é€²
## å¤§å­¸æ•™ç§‘æ›¸ ç¬¬0ç« ï¼šç†è«–åŸºç¤èˆ‡ç™¼å±•è„ˆçµ¡

**èª²ç¨‹ç·¨è™Ÿ**: CS785 - ä¼æ¥­ç´šæª¢ç´¢å¢å¼·ç”Ÿæˆç³»çµ±
**ç« ç¯€**: ç¬¬0ç«  ç†è«–åŸºç¤
**å­¸ç¿’æ™‚æ•¸**: 4å°æ™‚
**å…ˆä¿®èª²ç¨‹**: æ©Ÿå™¨å­¸ç¿’åŸºç¤, è‡ªç„¶èªè¨€è™•ç†æ¦‚è«–
**ä½œè€…**: ä¼æ¥­AIç ”ç©¶åœ˜éšŠ
**æœ€å¾Œæ›´æ–°**: 2025-01-06

---

## ğŸ“š å­¸ç¿’ç›®æ¨™ (Learning Objectives)

å®Œæˆæœ¬ç« å­¸ç¿’å¾Œï¼Œå­¸ç”Ÿæ‡‰èƒ½å¤ :

1. **ç†è«–åŸºç¤**: å¾ç¬¬ä¸€æ€§åŸç†åˆ†æ RAG ç³»çµ±çš„æˆåŠŸç‡æ•¸å­¸æ¨¡å‹
2. **æ­·å²è„ˆçµ¡**: ç†è§£ RAG å¾ Naive åˆ° Agentic çš„ä¸‰ä»£æ¼”é€²é‚è¼¯
3. **å•é¡Œè­˜åˆ¥**: è¨ºæ–·ä¼æ¥­çŸ¥è­˜åº«çš„ç³»çµ±æ€§å¤±çœŸä¾†æº
4. **è§£æ±ºæ–¹æ¡ˆ**: è¨­è¨ˆé‡å°æ€§çš„å·¥ç¨‹å°ç­–ä»¥æå‡ç³»çµ±å¯é æ€§

---

## 1. ç·’è«–ï¼šä¼æ¥­çŸ¥è­˜åº«çš„ç¾å¯¦æŒ‘æˆ°

### 1.1 å•é¡Œé™³è¿° (Problem Statement)

æª¢ç´¢å¢å¼·ç”Ÿæˆ (Retrieval-Augmented Generation, RAG) ç³»çµ±æ—¨åœ¨å°‡ä¼æ¥­å…§éƒ¨çŸ¥è­˜èˆ‡å¤§å‹èªè¨€æ¨¡å‹ (Large Language Model, LLM) å³æ™‚æ•´åˆï¼Œç†è«–æ¶æ§‹ç°¡æ½”æ˜ç­ï¼š**æŸ¥è©¢ â†’ æª¢ç´¢ â†’ æ‹¼æ¥ â†’ ç”Ÿæˆ**ã€‚ç„¶è€Œï¼Œåœ¨ä¼æ¥­å¯¦éš›éƒ¨ç½²ä¸­ï¼ŒRAG ç³»çµ±ç¶“å¸¸é­é‡ä¸‰å¤§ç³»çµ±æ€§å¤±æ•ˆï¼š

#### **å¤±æ•ˆæ¨¡å¼åˆ†æ**

**1. çŸ¥è­˜åº«æ²»ç†å¤±çœŸ (Knowledge Base Governance Failure)**
- **æ•¸æ“šå“è³ªå•é¡Œ**: ä¼æ¥­æ–‡æª”æ™®éå­˜åœ¨ç‰ˆæœ¬æ··äº‚ã€å…§å®¹éæ™‚ã€ä¾†æºä¸æ˜ç­‰å•é¡Œ (Wang et al., 2023)[^1]
- **æ¬Šé™ç®¡ç†ç¼ºå¤±**: ç¼ºä¹ç´°ç²’åº¦çš„è¨ªå•æ§åˆ¶å’Œæ•¸æ“šåˆ†é¡æ¨™æº–
- **å…ƒæ•¸æ“šè²§ä¹**: ç¼ºä¹çµæ§‹åŒ–çš„æ–‡æª”å±¬æ€§æ¨™è¨˜ï¼Œå¦‚ä½œè€…ã€å‰µå»ºæ™‚é–“ã€æ›´æ–°é »ç‡ç­‰

**2. æª¢ç´¢å“è³ªå¤±çœŸ (Retrieval Quality Degradation)**
- **èªç¾©å¤±é… (Semantic Mismatch)**: ç”¨æˆ¶æŸ¥è©¢æªè¾­èˆ‡æ–‡æª”è¡“èªå­˜åœ¨èªè¨€æ–·å±¤ (Lewis et al., 2020)[^2]
- **åµŒå…¥ç©ºé–“å¤±çœŸ**: å‘é‡è¡¨ç¤ºç„¡æ³•å®Œæ•´æ•æ‰æ–‡æœ¬èªç¾©ï¼Œç‰¹åˆ¥æ˜¯å°ˆæ¥­è¡“èªå’Œç¸®ç•¥èª
- **ç´¢å¼•è¿‘ä¼¼èª¤å·®**: è¿‘ä¼¼æœ€è¿‘é„° (ANN) æ¼”ç®—æ³•å¼•å…¥çš„æª¢ç´¢ç²¾åº¦æå¤±

**3. ä¸Šä¸‹æ–‡å·¥ç¨‹å¤±çœŸ (Context Engineering Distortion)**
- **ä¸­æ®µéºå¤±æ•ˆæ‡‰ (Lost-in-the-Middle)**: Liu et al. (2023)[^3] ç³»çµ±æ€§è­‰æ˜äº†é•·ä¸Šä¸‹æ–‡ä¸­çš„ä½ç½®åç½®ç¾è±¡
- **ä¿¡å™ªæ¯”å•é¡Œ**: ç„¡é—œä¿¡æ¯ç¨€é‡‹é—œéµè­‰æ“šçš„å¯è¦‹åº¦
- **ä¸Šä¸‹æ–‡çµ„è£å¤±åº**: ç¼ºä¹åˆç†çš„ä¿¡æ¯æ’åºå’Œå»é‡ç­–ç•¥

### 1.2 ä¼æ¥­éƒ¨ç½²çš„ GIGO ç½é›£

> "åƒåœ¾é€²ï¼Œåƒåœ¾å‡º" (Garbage In, Garbage Out) â€”â€” é€™æ˜¯ä¿¡æ¯ç³»çµ±çš„éµå¾‹

ä¼æ¥­çŸ¥è­˜åº«æœ¬è³ªä¸Šæ˜¯é«˜ç†µç³»çµ±ï¼Œé¢è‡¨ä»¥ä¸‹å…¸å‹å•é¡Œï¼š

#### **å…§å®¹æ™‚æ•ˆæ€§å•é¡Œ**
- **æ•¸æ“šè€åŒ–**: Confluenceã€SharePoint ä¸­å¤§é‡æ–‡æª”åœç•™åœ¨ 2019 å¹´ç‰ˆæœ¬
- **ç‰ˆæœ¬è¡çª**: ä¸åŒéƒ¨é–€å°åŒä¸€æµç¨‹çš„æè¿°ç›¸äº’çŸ›ç›¾
- **æ­»éˆæ°¾æ¿«**: å…§éƒ¨é€£çµå’Œåƒè€ƒé—œä¿‚ç ´æ

#### **ä¸Šä¸‹æ–‡ç¼ºå¤±å•é¡Œ**
- **éƒ¨è½çŸ¥è­˜**: æŠ€è¡“æ–‡æª”å……æ»¿éš±å«å‡è¨­ï¼ŒRAG ç„¡æ³•ç†è§£èƒŒæ™¯çŸ¥è­˜
- **çŸ¥è­˜å­¤å³¶**: ç›¸é—œä¿¡æ¯æ•£è½åœ¨ä¸åŒç³»çµ±ï¼Œç¼ºä¹çµ±ä¸€ç´¢å¼•
- **å°ˆå®¶ä¾è³´**: é—œéµçŸ¥è­˜åªå­˜åœ¨æ–¼ç‰¹å®šäººå“¡çš„ç¶“é©—ä¸­

#### **æ²»ç†çœŸç©ºå•é¡Œ**
- **æ‰€æœ‰æ¬Šæ¨¡ç³Š**: å…§å®¹ç¼ºä¹æ˜ç¢ºçš„ç¶­è­·è²¬ä»»äºº
- **å¯©æ ¸é€±æœŸç¼ºå¤±**: æ²’æœ‰å®šæœŸçš„å…§å®¹è³ªé‡æª¢æŸ¥æ©Ÿåˆ¶
- **æ¬Šé™æ··äº‚**: è¨ªå•æ§åˆ¶ä¸å¤ ç²¾ç´°ï¼Œå­˜åœ¨å®‰å…¨éš±æ‚£

**å¼•ç† 1.1** (ä¼æ¥­çŸ¥è­˜ç†µå¢å®šå¾‹): åœ¨ç¼ºä¹ä¸»å‹•æ²»ç†çš„æƒ…æ³ä¸‹ï¼Œä¼æ¥­çŸ¥è­˜åº«çš„ä¿¡æ¯ç†µéš¨æ™‚é–“å–®èª¿éå¢ï¼Œå°è‡´ RAG ç³»çµ±æ€§èƒ½å¿…ç„¶è¡°é€€ã€‚

---

## 2. RAG ç³»çµ±å¤±çœŸçš„ç¬¬ä¸€æ€§åŸç†åˆ†æ

### 2.1 æˆåŠŸç‡æ•¸å­¸æ¨¡å‹

åŸºæ–¼ä¿¡æ¯æª¢ç´¢ç†è«–å’Œæ¦‚ç‡è«–ï¼Œæˆ‘å€‘å¯ä»¥å°‡ RAG ç³»çµ±çš„æˆåŠŸç‡åˆ†è§£ç‚ºå››å€‹ç¨ç«‹äº‹ä»¶çš„è¯åˆæ¦‚ç‡ï¼š

#### **å®šç† 2.1** (RAG æˆåŠŸç‡åˆ†è§£å®šç†)

RAG ç³»çµ±ç”¢ç”Ÿæ­£ç¢ºå›ç­”çš„æ¦‚ç‡å¯è¡¨ç¤ºç‚ºï¼š

$$P(\text{æ­£ç¢º}) = P(\text{æª¢ç´¢å‘½ä¸­} | q) \times P(\text{æ’åºç½®å‰} | \text{å‘½ä¸­}) \times P(\text{ä¸Šä¸‹æ–‡å¯ç”¨} | \text{ç½®å‰}) \times P(\text{ç”Ÿæˆå¿ å¯¦} | \text{ä¸Šä¸‹æ–‡})$$

å…¶ä¸­ï¼š
- $P(\text{æª¢ç´¢å‘½ä¸­} | q)$: çµ¦å®šæŸ¥è©¢ $q$ï¼Œç›¸é—œæ–‡æª”è¢«æª¢ç´¢åˆ°çš„æ¦‚ç‡ (Recall@k)
- $P(\text{æ’åºç½®å‰} | \text{å‘½ä¸­})$: çµ¦å®šå‘½ä¸­æ–‡æª”ï¼Œå…¶è¢«æ’åºåˆ°å‰ä½çš„æ¦‚ç‡ (Precision@k)
- $P(\text{ä¸Šä¸‹æ–‡å¯ç”¨} | \text{ç½®å‰})$: çµ¦å®šå‰æ’æ–‡æª”ï¼Œå½¢æˆæœ‰æ•ˆä¸Šä¸‹æ–‡çš„æ¦‚ç‡
- $P(\text{ç”Ÿæˆå¿ å¯¦} | \text{ä¸Šä¸‹æ–‡})$: çµ¦å®šæœ‰æ•ˆä¸Šä¸‹æ–‡ï¼Œç”Ÿæˆå¿ å¯¦å›ç­”çš„æ¦‚ç‡ (Faithfulness)

#### **æ¨è«– 2.1** (ç³»çµ±æ€§èƒ½ç“¶é ¸è­˜åˆ¥)

ç”±æ–¼å„äº‹ä»¶ç›¸å°ç¨ç«‹ï¼Œç³»çµ±æ•´é«”æ€§èƒ½å—æœ€ä½æ¦‚ç‡äº‹ä»¶åˆ¶ç´„ã€‚å› æ­¤ï¼Œå„ªåŒ–ç­–ç•¥æ‡‰å„ªå…ˆæå‡ç“¶é ¸ç’°ç¯€ã€‚

### 2.2 å¤±çœŸä¾†æºçš„ç³»çµ±åˆ†æ

#### **æª¢ç´¢å¤±çœŸ (Retrieval Distortion)**

**å®šç¾©**: æª¢ç´¢éšæ®µå¼•å…¥çš„ä¿¡æ¯æå¤±å’Œå™ªéŸ³

**ä¸»è¦åŸå› **:
1. **å‘é‡ç©ºé–“ä¸å®Œå‚™æ€§**: åµŒå…¥æ¨¡å‹ç„¡æ³•å®Œæ•´è¡¨ç¤ºæ–‡æœ¬èªç¾© (Reimers & Gurevych, 2019)[^4]
2. **è¿‘ä¼¼æª¢ç´¢èª¤å·®**: HNSWã€IVF ç­‰è¿‘ä¼¼ç®—æ³•çš„ç²¾åº¦-é€Ÿåº¦æ¬Šè¡¡ (Malkov & Yashunin, 2018)[^5]
3. **åˆ†å¡Šèªç¾©ç ´å£**: å›ºå®šé•·åº¦åˆ‡åˆ†ç ´å£èªç¾©å®Œæ•´æ€§ (Khattab & Zaharia, 2020)[^6]

**é‡åŒ–æŒ‡æ¨™**:
- æª¢ç´¢å¬å›ç‡: $\text{Recall@k} = \frac{|\text{ç›¸é—œæ–‡æª”} \cap \text{æª¢ç´¢çµæœ}|}{|\text{ç›¸é—œæ–‡æª”}|}$
- æª¢ç´¢ç²¾ç¢ºåº¦: $\text{Precision@k} = \frac{|\text{ç›¸é—œæ–‡æª”} \cap \text{æª¢ç´¢çµæœ}|}{|\text{æª¢ç´¢çµæœ}|}$

#### **æ’åºå¤±çœŸ (Ranking Distortion)**

**å®šç¾©**: ç›¸é—œæ–‡æª”æœªèƒ½æ’åºåˆ°å‰ä½ï¼Œå°è‡´ä¸Šä¸‹æ–‡å“è³ªä¸‹é™

**ç†è«–åŸºç¤**: åŸºæ–¼ Robertson & Sparck Jones (1976)[^7] çš„æ¦‚ç‡æª¢ç´¢æ¨¡å‹ï¼Œç›¸é—œæ€§æ’åºçš„æœ€å„ªç­–ç•¥æ˜¯ï¼š

$$P(\text{ç›¸é—œ}|d,q) = \frac{P(d|q,\text{ç›¸é—œ}) \cdot P(\text{ç›¸é—œ})}{P(d|q)}$$

**å·¥ç¨‹è§£æ±ºæ–¹æ¡ˆ**: Cross-encoder é‡æ’åºèƒ½å¤ é€šéè¯åˆå»ºæ¨¡ $(q,d)$ å°ä¾†æå‡æ’åºç²¾åº¦ã€‚

#### **ä¸Šä¸‹æ–‡å¤±çœŸ (Context Distortion)**

**å®šç¾©**: æœ‰æ•ˆä¿¡æ¯åœ¨é•·ä¸Šä¸‹æ–‡ä¸­çš„å¯è¦‹åº¦ä¸‹é™

**å¯¦è­‰åŸºç¤**: Liu et al. (2023)[^3] é€šéå¤§è¦æ¨¡å¯¦é©—è­‰æ˜äº† **"Lost-in-the-Middle"** ç¾è±¡:

- é•·ä¸Šä¸‹æ–‡æ¨¡å‹å‘ˆç¾ **U å‹æ³¨æ„åŠ›åˆ†ä½ˆ**
- ä½æ–¼ä¸Šä¸‹æ–‡ä¸­æ®µçš„ä¿¡æ¯è¢«ç³»çµ±æ€§å¿½ç•¥
- æ•ˆæ‡‰åœ¨ 4K-32K token ç¯„åœå…§æŒçºŒå­˜åœ¨

**æ•¸å­¸æè¿°**: è¨­ä¸Šä¸‹æ–‡é•·åº¦ç‚º $L$ï¼Œä½ç½®ç‚º $p$ï¼Œå‰‡æ³¨æ„åŠ›æ¬Šé‡è¿‘ä¼¼ç‚ºï¼š

$$\text{Attention}(p) \approx \alpha \cdot \exp(-\beta \cdot |p - L/2|) + \gamma$$

å…¶ä¸­ $\alpha, \beta, \gamma$ ç‚ºæ¨¡å‹ç›¸é—œåƒæ•¸ã€‚

#### **ç”Ÿæˆå¤±çœŸ (Generation Distortion)**

**å®šç¾©**: LLM æœªèƒ½å¿ å¯¦åœ°åŸºæ–¼æä¾›çš„ä¸Šä¸‹æ–‡ç”Ÿæˆå›ç­”

**å¤±çœŸæ©Ÿåˆ¶**:
1. **å…ˆé©—åç½®**: LLM å‚¾å‘æ–¼ä¾è³´è¨“ç·´æ•¸æ“šä¸­çš„å…ˆé©—çŸ¥è­˜è€Œéç•¶å‰ä¸Šä¸‹æ–‡ (Petroni et al., 2019)[^8]
2. **ç¶œåˆå¤±æ•—**: é¢å°çŸ›ç›¾ä¿¡æ¯æ™‚ç„¡æ³•é€²è¡Œæœ‰æ•ˆè£æ±º
3. **å¹»è¦ºç”Ÿæˆ**: åœ¨ä¿¡æ¯ä¸è¶³æ™‚ç”¢ç”Ÿçœ‹ä¼¼åˆç†ä½†å¯¦éš›éŒ¯èª¤çš„å…§å®¹

---

## 3. RAG ç³»çµ±çš„ä¸–ä»£æ¼”é€²

### 3.1 ä¸–ä»£ä¸€ï¼šNaive RAG (2020-2023)

#### **ç³»çµ±æ¶æ§‹**

Naive RAG æ¡ç”¨ç·šæ€§ç®¡é“è¨­è¨ˆï¼š

```
ç”¨æˆ¶æŸ¥è©¢ â†’ å‘é‡åµŒå…¥ â†’ ç›¸ä¼¼æ€§æª¢ç´¢ â†’ ä¸Šä¸‹æ–‡æ‹¼æ¥ â†’ LLM ç”Ÿæˆ
```

#### **æ ¸å¿ƒçµ„ä»¶åˆ†æ**

**ç´¢å¼•å­ç³»çµ± (Indexing Subsystem)**:
- **æ–‡æª”åˆ†å¡Š**: å›ºå®šé•·åº¦åˆ‡åˆ† (é€šå¸¸ 512-1024 tokens)
- **å‘é‡åŒ–**: ä½¿ç”¨å¯†é›†åµŒå…¥æ¨¡å‹ (å¦‚ Sentence-BERT)
- **å­˜å„²**: å‘é‡è³‡æ–™åº« (FAISS, Pinecone, Weaviate)

**æª¢ç´¢å­ç³»çµ± (Retrieval Subsystem)**:
- **æŸ¥è©¢ç·¨ç¢¼**: æŸ¥è©¢æ–‡æœ¬å‘é‡åŒ–
- **ç›¸ä¼¼æ€§æœç´¢**: é¤˜å¼¦ç›¸ä¼¼åº¦æˆ–æ­å¹¾é‡Œå¾—è·é›¢
- **çµæœè¿”å›**: Top-K æœ€ç›¸ä¼¼æ–‡æª”ç‰‡æ®µ

**ç”Ÿæˆå­ç³»çµ± (Generation Subsystem)**:
- **ä¸Šä¸‹æ–‡æ§‹å»º**: ç°¡å–®çš„æ–‡æª”ç‰‡æ®µæ‹¼æ¥
- **æç¤ºå·¥ç¨‹**: åŸºç¤çš„ "åŸºæ–¼ä»¥ä¸‹å…§å®¹å›ç­”å•é¡Œ" æ¨¡æ¿
- **å›ç­”ç”Ÿæˆ**: ç›´æ¥èª¿ç”¨ LLM API

#### **ç†è«–é™åˆ¶åˆ†æ**

**å®šç† 3.1** (Naive RAG æ€§èƒ½ä¸Šç•Œ): åœ¨å›ºå®šåˆ†å¡Šå’Œå–®ä¸€æª¢ç´¢ç­–ç•¥ä¸‹ï¼Œç³»çµ±æ€§èƒ½å—é™æ–¼ï¼š

$$\text{Performance} \leq \min(\text{Chunking Quality}, \text{Retrieval Precision}, \text{Context Utilization})$$

**è­‰æ˜æ€è·¯**: ç”±æ–¼ç³»çµ±æ¡ç”¨ä¸²è¡Œè™•ç†ï¼Œä»»ä¸€ç’°ç¯€çš„å¤±æ•ˆéƒ½æœƒå°è‡´æ•´é«”å¤±æ•—ï¼Œå› æ­¤æ€§èƒ½ä¸Šç•Œç”±æœ€å¼±ç’°ç¯€æ±ºå®šã€‚â–¡

### 3.2 ä¸–ä»£äºŒï¼šAdvanced RAG (2023-2024)

#### **æ¶æ§‹æ”¹é€²**

Advanced RAG å¼•å…¥å¤šéšæ®µå„ªåŒ–ï¼Œå½¢æˆå¢å¼·ç®¡é“ï¼š

```
æŸ¥è©¢é‡å¯« â†’ æ··åˆæª¢ç´¢ â†’ çµæœé‡æ’ â†’ ä¸Šä¸‹æ–‡å£“ç¸® â†’ å¢å¼·ç”Ÿæˆ
```

#### **é—œéµæŠ€è¡“å‰µæ–°**

**1. æŸ¥è©¢å„ªåŒ– (Query Optimization)**

**å®šç¾© 3.1** (æŸ¥è©¢æ“´å±•): çµ¦å®šåŸå§‹æŸ¥è©¢ $q_0$ï¼Œç”Ÿæˆèªç¾©ç›¸é—œçš„æŸ¥è©¢è®Šé«”é›†åˆ $Q = \{q_1, q_2, ..., q_n\}$ï¼Œä»¥æå‡æª¢ç´¢è¦†è“‹ç‡ã€‚

**æŠ€è¡“å¯¦ç¾**:
- **åŒç¾©è©æ“´å±•**: ä½¿ç”¨ä¼æ¥­è¡“èªè©å…¸
- **æŸ¥è©¢æ”¹å¯«**: åŸºæ–¼ T5 æ¨¡å‹çš„ç¥ç¶“æ”¹å¯«
- **å¤šè¦–è§’ç”Ÿæˆ**: å¾ä¸åŒè§’åº¦é‡æ§‹æŸ¥è©¢

**2. æ··åˆæª¢ç´¢ (Hybrid Retrieval)**

**å®šç† 3.2** (æª¢ç´¢ç­–ç•¥äº’è£œæ€§): å¯†é›†æª¢ç´¢å’Œç¨€ç–æª¢ç´¢åœ¨ä¸åŒæŸ¥è©¢é¡å‹ä¸Šå‘ˆç¾äº’è£œæ€§èƒ½ï¼Œå…¶çµ„åˆèƒ½é¡¯è‘—æå‡æ•´é«”å¬å›ç‡ã€‚

**æ•¸å­¸è¡¨é”**:
$$\text{Score}_{\text{hybrid}}(d,q) = \alpha \cdot \text{Score}_{\text{dense}}(d,q) + \beta \cdot \text{Score}_{\text{sparse}}(d,q)$$

å…¶ä¸­ $\alpha + \beta = 1$ï¼Œæ¬Šé‡é€šéé›¢ç·šè©•ä¼°ç¢ºå®šã€‚

**3. å€’æ•¸æ’åèåˆ (Reciprocal Rank Fusion, RRF)**

**å®šç¾© 3.2**: çµ¦å®šå¤šå€‹æª¢ç´¢çµæœåˆ—è¡¨ï¼ŒRRF ç®—æ³•è¨ˆç®—æ–‡æª” $d$ çš„èåˆåˆ†æ•¸ç‚ºï¼š

$$\text{RRF}(d) = \sum_{i=1}^{n} \frac{1}{k + \text{rank}_i(d)}$$

å…¶ä¸­ $k$ ç‚ºå¹³æ»‘åƒæ•¸ (é€šå¸¸å–60)ï¼Œ$\text{rank}_i(d)$ ç‚ºæ–‡æª” $d$ åœ¨ç¬¬ $i$ å€‹çµæœåˆ—è¡¨ä¸­çš„æ’åã€‚

**4. äº¤å‰ç·¨ç¢¼å™¨é‡æ’åº (Cross-Encoder Reranking)**

**åŸç†**: èˆ‡åµŒå…¥æ¨¡å‹çš„é›™å¡”æ¶æ§‹ä¸åŒï¼Œäº¤å‰ç·¨ç¢¼å™¨æ¡ç”¨å–®å¡”æ¶æ§‹ï¼Œè¯åˆç·¨ç¢¼æŸ¥è©¢-æ–‡æª”å°ï¼š

$$\text{Score}_{\text{rerank}}(q,d) = \text{CrossEncoder}(q \oplus d)$$

å…¶ä¸­ $\oplus$ è¡¨ç¤ºæ–‡æœ¬æ‹¼æ¥æ“ä½œã€‚

**æ€§èƒ½æå‡**: å¯¦è­‰ç ”ç©¶é¡¯ç¤ºï¼Œé‡æ’åºèƒ½å°‡ nDCG@10 æå‡ 15-25% (Khattab et al., 2021)[^9]ã€‚

#### **æ¶æ§‹å„ªå‹¢èˆ‡å±€é™**

**å„ªå‹¢**:
- ç›´æ¥é‡å° Naive RAG çš„å·²çŸ¥å¤±æ•ˆé»é€²è¡Œå„ªåŒ–
- ä¿æŒç³»çµ±æ¶æ§‹çš„ç›¸å°ç°¡å–®æ€§
- å¯èˆ‡ç¾æœ‰åŸºç¤è¨­æ–½è¼ƒå¥½æ•´åˆ

**å±€é™**:
- ä»ç‚ºéœæ…‹ç®¡é“ï¼Œç¼ºä¹å‹•æ…‹é©æ‡‰èƒ½åŠ›
- ç„¡æ³•è™•ç†è¤‡é›œçš„å¤šæ­¥æ¨ç†ä»»å‹™
- å°ä¸åŒæŸ¥è©¢é¡å‹æ¡ç”¨ç›¸åŒè™•ç†ç­–ç•¥

### 3.3 ä¸–ä»£ä¸‰ï¼šModular RAG (2024-è‡³ä»Š)

#### **ç¯„å¼è½‰ç§»**

Modular RAG ä»£è¡¨å¾ **ç®¡é“æ€ç¶­** åˆ° **ç³»çµ±æ€ç¶­** çš„ç¯„å¼è½‰ç§»ï¼Œæ ¸å¿ƒç‰¹å¾µï¼š

1. **çµ„ä»¶æ¨¡çµ„åŒ–**: æª¢ç´¢ã€é‡æ’ã€ç”Ÿæˆç­‰åŠŸèƒ½è§£è€¦ç‚ºå¯æ›¿æ›æ¨¡çµ„
2. **å‹•æ…‹è·¯ç”±**: åŸºæ–¼æŸ¥è©¢ç‰¹å¾µæ™ºèƒ½é¸æ“‡è™•ç†ç­–ç•¥
3. **ç‹€æ…‹ç®¡ç†**: æ”¯æŒå¤šè¼ªå°è©±å’Œè¤‡é›œä»»å‹™çš„ç‹€æ…‹æŒä¹…åŒ–

#### **æ¶æ§‹çµ„ä»¶**

**æª¢ç´¢å™¨æ— (Retriever Family)**:
- **å‘é‡æª¢ç´¢å™¨**: èªç¾©æœç´¢ï¼Œé©ç”¨æ–¼æ¦‚å¿µæŸ¥è©¢
- **ç¨€ç–æª¢ç´¢å™¨**: é—œéµå­—æœç´¢ï¼Œé©ç”¨æ–¼ç²¾ç¢ºåŒ¹é…
- **åœ–æª¢ç´¢å™¨**: é—œä¿‚éæ­·ï¼Œé©ç”¨æ–¼å¤šè·³æ¨ç†
- **SQLæª¢ç´¢å™¨**: çµæ§‹åŒ–æŸ¥è©¢ï¼Œé©ç”¨æ–¼æ•¸æ“šåˆ†æ

**ç²¾ç…‰å™¨æ— (Refiner Family)**:
- **é‡æ’åºå™¨**: æå‡æª¢ç´¢ç²¾åº¦
- **ç¸½çµå™¨**: å£“ç¸®å†—é•·å…§å®¹
- **æå–å™¨**: æŠ½å–é—œéµä¿¡æ¯

**æ±ºç­–è·¯ç”±å™¨ (Decision Router)**:
åŸºæ–¼ LLM çš„æ™ºèƒ½è·¯ç”±å™¨ï¼Œæ ¹æ“šæŸ¥è©¢ç‰¹å¾µå‹•æ…‹é¸æ“‡æœ€é©åˆçš„è™•ç†è·¯å¾‘ã€‚

#### **è»Ÿé«”å·¥ç¨‹è¦–è§’çš„æ¼”é€²åˆ†æ**

| ä¸–ä»£ | è»Ÿé«”æ¶æ§‹é¡æ¯” | ç‰¹å¾µ | é©ç”¨å ´æ™¯ |
|------|------------|------|---------|
| Naive RAG | å–®é«”è…³æœ¬ | ç·šæ€§ã€å›ºå®šã€ç°¡å–® | åŸå‹é–‹ç™¼ |
| Advanced RAG | è¤‡é›œå–®é«”æ‡‰ç”¨ | å„ªåŒ–ã€å›ºå®šç®¡é“ | ç‰¹å®šé ˜åŸŸæ‡‰ç”¨ |
| Modular RAG | å¾®æœå‹™æ¶æ§‹ | æ¨¡çµ„åŒ–ã€å‹•æ…‹è·¯ç”± | ä¼æ¥­ç´šç³»çµ± |

é€™ä¸€æ¼”é€²éµå¾ªè»Ÿé«”å·¥ç¨‹çš„ç¶“å…¸æ¨¡å¼ï¼šå¾å–®é«”åˆ°å¾®æœå‹™çš„æ¶æ§‹å‡ç´šï¼Œé«”ç¾äº†ç³»çµ±è¤‡é›œåº¦ç®¡ç†çš„å¿…ç„¶è¶¨å‹¢ã€‚

---

## 4. å…ˆé€²æª¢ç´¢æŠ€è¡“çš„ç†è«–åŸºç¤

### 4.1 å‡è¨­æ€§æ–‡æª”åµŒå…¥ (Hypothetical Document Embeddings, HyDE)

#### **æ–¹æ³•åŸç†**

HyDE ç”± Gao et al. (2022)[^10] æå‡ºï¼Œå…¶æ ¸å¿ƒå‰µæ–°æ˜¯å°‡æª¢ç´¢ç©ºé–“å¾ **æŸ¥è©¢-æ–‡æª”** è½‰æ›ç‚º **æ–‡æª”-æ–‡æª”**ï¼š

1. **å‡è¨­ç”Ÿæˆéšæ®µ**: $A' = \text{LLM}(q)$
2. **åµŒå…¥æª¢ç´¢éšæ®µ**: $D = \text{Retrieve}(\text{Embed}(A'))$

#### **ç†è«–å„ªå‹¢**

**å®šç† 4.1** (åµŒå…¥ç©ºé–“å°é½Š): å‡è¨­æ€§æ–‡æª”èˆ‡çœŸå¯¦æ–‡æª”åœ¨åµŒå…¥ç©ºé–“ä¸­å…·æœ‰æ›´é«˜çš„ç›¸ä¼¼åº¦ï¼Œå› ç‚ºå®ƒå€‘å…±äº«ç›¸åŒçš„èªè¨€æ¨¡å¼å’Œæ¦‚å¿µè¡¨é”ã€‚

**æ•¸å­¸è¡¨é”**:
$$\text{Sim}(\text{Embed}(A'), \text{Embed}(D_{\text{true}})) > \text{Sim}(\text{Embed}(q), \text{Embed}(D_{\text{true}}))$$

**å¯¦è­‰é©—è­‰**: åœ¨å¤šå€‹åŸºæº–æ¸¬è©¦ä¸­ï¼ŒHyDE ç›¸è¼ƒæ–¼ç›´æ¥æŸ¥è©¢æª¢ç´¢æå‡ 2-5% çš„æª¢ç´¢ç²¾åº¦ (Gao et al., 2022)ã€‚

### 4.2 é€€æ­¥æç¤º (Step-Back Prompting)

#### **æ–¹æ³•æ©Ÿåˆ¶**

Step-Back Prompting é€šéæŠ½è±¡åŒ–æŸ¥è©¢ä¾†æ”¹å–„æª¢ç´¢æ•ˆæœï¼š

1. **æŠ½è±¡åŒ–éšæ®µ**: å°‡å…·é«”æŸ¥è©¢è½‰æ›ç‚ºé«˜å±¤æ¦‚å¿µ
2. **æª¢ç´¢éšæ®µ**: åŸºæ–¼æŠ½è±¡æŸ¥è©¢é€²è¡Œæ–‡æª”æª¢ç´¢
3. **å›ç­”éšæ®µ**: ä½¿ç”¨æª¢ç´¢åˆ°çš„å»£æ³›ä¸Šä¸‹æ–‡å›ç­”åŸå§‹å…·é«”å•é¡Œ

#### **é©ç”¨æ€§åˆ†æ**

**å¼•ç† 4.1** (æŠ½è±¡-å…·é«”æª¢ç´¢åŸç†): å°æ–¼äº‹å¯¦å¯†é›†å‹æŸ¥è©¢ï¼ŒæŠ½è±¡æ¦‚å¿µçš„æª¢ç´¢æˆåŠŸç‡é€šå¸¸é«˜æ–¼å…·é«”äº‹å¯¦çš„ç›´æ¥æª¢ç´¢ã€‚

**æ‡‰ç”¨å ´æ™¯**:
- **äººç‰©ç”Ÿå¹³æŸ¥è©¢**: "æŸæŸåœ¨2007å¹´çš„å…·é«”å·¥ä½œ" â†’ "æŸæŸçš„è·æ¥­æ­·ç¨‹"
- **æŠ€è¡“è¦æ ¼æŸ¥è©¢**: "API v2.3çš„ç‰¹å®šåƒæ•¸" â†’ "APIå®Œæ•´æ–‡æª”"
- **æ­·å²äº‹ä»¶æŸ¥è©¢**: "æŸæ—¥çš„å…·é«”æ±ºè­°" â†’ "è©²æ™‚æœŸçš„æ”¿ç­–èƒŒæ™¯"

---

## 5. ä¸Šä¸‹æ–‡å·¥ç¨‹çš„ç³»çµ±ç†è«–

### 5.1 ä¸Šä¸‹æ–‡å·¥ç¨‹å®šç¾©æ¡†æ¶

**å®šç¾© 5.1** (ä¸Šä¸‹æ–‡å·¥ç¨‹): è¨­è¨ˆå’Œæ§åˆ¶ AI æ¨¡å‹åœ¨ç”Ÿæˆå›æ‡‰å‰æ‰€èƒ½æ„ŸçŸ¥çš„æ‰€æœ‰ä¿¡æ¯çš„ç³»çµ±æ€§å¯¦è¸ã€‚

ä¸Šä¸‹æ–‡å·¥ç¨‹åŒ…å«ä½†ä¸é™æ–¼ï¼š
- **ä¿¡æ¯é¸æ“‡**: æ±ºå®šå“ªäº›ä¿¡æ¯é€²å…¥ä¸Šä¸‹æ–‡
- **ä¿¡æ¯æ’åº**: ç¢ºå®šä¿¡æ¯åœ¨ä¸Šä¸‹æ–‡ä¸­çš„ä½ç½®
- **ä¿¡æ¯å£“ç¸®**: åœ¨ä¿æŒé—œéµä¿¡æ¯çš„å‰æä¸‹æ¸›å°‘ä¸Šä¸‹æ–‡é•·åº¦
- **ä¿¡æ¯æ ¼å¼åŒ–**: å°‡åŸå§‹ä¿¡æ¯è½‰æ›ç‚ºæ¨¡å‹å‹å¥½çš„æ ¼å¼

### 5.2 ä½ç½®åç½®çš„æ•¸å­¸æ¨¡å‹

#### **æ³¨æ„åŠ›åˆ†ä½ˆæ¨¡å‹**

åŸºæ–¼ Liu et al. (2023) çš„å¯¦è­‰è§€å¯Ÿï¼Œé•·ä¸Šä¸‹æ–‡æ³¨æ„åŠ›å¯å»ºæ¨¡ç‚ºï¼š

$$\text{Attention}(p) = \alpha \cdot \exp\left(-\frac{(p-\mu)^2}{2\sigma^2}\right) + \beta \cdot \mathcal{U}(0,1)$$

å…¶ä¸­ï¼š
- $p$: ä¿¡æ¯åœ¨ä¸Šä¸‹æ–‡ä¸­çš„ä½ç½® (æ¨™æº–åŒ–åˆ°[0,1])
- $\mu$: æ³¨æ„åŠ›å³°å€¼ä½ç½® (é€šå¸¸åœ¨0å’Œ1é™„è¿‘)
- $\sigma$: æ³¨æ„åŠ›åˆ†ä½ˆçš„æ–¹å·®
- $\alpha, \beta$: æ¬Šé‡åƒæ•¸
- $\mathcal{U}(0,1)$: å‡å‹»åˆ†ä½ˆå™ªéŸ³é …

#### **å„ªåŒ–ç­–ç•¥**

**ç­–ç•¥ 5.1** (é—œéµä¿¡æ¯å®šä½): å°‡æœ€é‡è¦çš„ä¿¡æ¯æ”¾ç½®åœ¨ä¸Šä¸‹æ–‡çš„é–‹å§‹ (ä½ç½® 0) æˆ–çµå°¾ (ä½ç½® 1)ï¼Œä»¥æœ€å¤§åŒ–å…¶è¢«æ¨¡å‹æ³¨æ„çš„æ¦‚ç‡ã€‚

**ç­–ç•¥ 5.2** (åˆ†å±¤é¤µé€): å°æ–¼è¶…é•·ä¸Šä¸‹æ–‡ï¼Œæ¡ç”¨å¤šè¼ªå°è©±æ–¹å¼é€æ­¥æä¾›ä¿¡æ¯ï¼Œé¿å…å–®è¼ªä¸Šä¸‹æ–‡éè¼‰ã€‚

---

## 6. å­¸ç¿’æ´»å‹•èˆ‡è©•ä¼°

### 6.1 æ¦‚å¿µæª¢æŸ¥é¡Œ

1. **åˆ†æé¡Œ**: è§£é‡‹ç‚ºä»€éº¼ RAG ç³»çµ±çš„æˆåŠŸç‡æ˜¯å››å€‹æ¦‚ç‡çš„ä¹˜ç©è€ŒéåŠ æ³•ï¼Ÿ
2. **è¨ˆç®—é¡Œ**: çµ¦å®šæª¢ç´¢å¬å›ç‡ 0.8ã€é‡æ’ç²¾ç¢ºåº¦ 0.9ã€ä¸Šä¸‹æ–‡åˆ©ç”¨ç‡ 0.7ã€ç”Ÿæˆå¿ å¯¦åº¦ 0.85ï¼Œè¨ˆç®—ç³»çµ±æ•´é«”æˆåŠŸç‡ã€‚
3. **è¨­è¨ˆé¡Œ**: é‡å°ä¸€å€‹åŒ…å«å¤§é‡éæœŸæ–‡æª”çš„ä¼æ¥­çŸ¥è­˜åº«ï¼Œè¨­è¨ˆä¸€å€‹æ”¹é€²æ–¹æ¡ˆã€‚

### 6.2 å¯¦ä½œç·´ç¿’

**ç·´ç¿’ 1**: å¯¦ç¾ RRF èåˆç®—æ³•
```python
def reciprocal_rank_fusion(results_lists, k=60):
    """
    å¯¦ç¾ RRF èåˆç®—æ³•

    åƒæ•¸:
        results_lists: å¤šå€‹æª¢ç´¢çµæœåˆ—è¡¨
        k: å¹³æ»‘åƒæ•¸

    è¿”å›:
        èåˆå¾Œçš„æ’åºçµæœ
    """
    # å­¸ç”Ÿå¯¦ç¾
    pass
```

**ç·´ç¿’ 2**: åˆ†æä½ç½®åç½®æ•ˆæ‡‰
è¨­è¨ˆå¯¦é©—æ¸¬é‡ä¸åŒæ¨¡å‹åœ¨ä¸åŒä¸Šä¸‹æ–‡é•·åº¦ä¸‹çš„ä½ç½®åç½®ç¨‹åº¦ã€‚

### 6.3 å»¶ä¼¸é–±è®€

#### **å¿…è®€è«–æ–‡**
1. Liu, N. et al. (2023). "Lost in the Middle: How Language Models Use Long Contexts." *arXiv preprint arXiv:2307.03172*.
2. Lewis, P. et al. (2020). "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks." *NeurIPS 2020*.
3. Gao, L. et al. (2022). "Precise Zero-Shot Dense Retrieval without Relevance Labels." *arXiv preprint arXiv:2212.10496*.

#### **åƒè€ƒè³‡æº**
- [MTEB Leaderboard](https://huggingface.co/spaces/mteb/leaderboard): åµŒå…¥æ¨¡å‹è©•ä¼°åŸºæº–
- [RAG Survey](https://arxiv.org/abs/2312.10997): RAG æŠ€è¡“å…¨æ™¯ç¶œè¿°
- [LangChain Documentation](https://python.langchain.com/): å¯¦ä½œæ¡†æ¶æ–‡æª”

---

## 7. æœ¬ç« å°çµ

### 7.1 æ ¸å¿ƒè¦é»å›é¡§

1. **ç¬¬ä¸€æ€§åŸç†**: RAG ç³»çµ±å¤±æ•ˆæºæ–¼æª¢ç´¢ã€æ’åºã€ä¸Šä¸‹æ–‡ã€ç”Ÿæˆå››å€‹éšæ®µçš„ç´¯ç©èª¤å·®
2. **æ¼”é€²é‚è¼¯**: å¾ç°¡å–®ç®¡é“åˆ°è¤‡é›œç³»çµ±çš„æ¼”åŒ–éµå¾ªè»Ÿé«”å·¥ç¨‹çš„å¾®æœå‹™åŒ–è¶¨å‹¢
3. **å·¥ç¨‹é‡é»**: ä¼æ¥­ç´š RAG çš„æˆåŠŸé—œéµåœ¨æ–¼æ•¸æ“šæ²»ç†è€Œéç®—æ³•å„ªåŒ–
4. **æœªä¾†æ–¹å‘**: å‘ä»£ç†åŒ–ã€æ¨¡çµ„åŒ–ã€è‡ªé©æ‡‰çš„æ™ºèƒ½ç³»çµ±ç™¼å±•

### 7.2 çŸ¥è­˜åœ°åœ–

```mermaid
mindmap
  root((RAGç†è«–åŸºç¤))
    ç¬¬ä¸€æ€§åŸç†
      æˆåŠŸç‡åˆ†è§£
      å¤±çœŸä¾†æºåˆ†æ
      æ•¸å­¸å»ºæ¨¡
    æ­·å²æ¼”é€²
      Naive RAG
      Advanced RAG
      Modular RAG
    æŠ€è¡“å‰µæ–°
      HyDE
      Step-Back
      RRFèåˆ
    ä¼æ¥­æŒ‘æˆ°
      çŸ¥è­˜åº«æ²»ç†
      ä¸Šä¸‹æ–‡å·¥ç¨‹
      ç³»çµ±æ•´åˆ
```

### 7.3 ä¸‹ç« é å‘Š

ç¬¬1ç« å°‡æ·±å…¥æ¢è¨ä¼æ¥­æ–‡æª”è™•ç†èˆ‡ DocOps ç®¡ç·šè¨­è¨ˆï¼Œé‡é»åˆ†æå¦‚ä½•å»ºç«‹é«˜å“è³ªçš„çŸ¥è­˜åº«åŸºç¤è¨­æ–½ï¼Œé€™æ˜¯ RAG ç³»çµ±æˆåŠŸçš„å‰ææ¢ä»¶ã€‚

---

## åƒè€ƒæ–‡ç»

[^1]: Wang, S., Liu, X., & Chen, Y. (2023). "Enterprise Knowledge Base Quality Assessment: A Systematic Study." *Information Management Journal*, 45(3), 123-145.

[^2]: Lewis, P., Perez, E., Piktus, A., et al. (2020). "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks." *Advances in Neural Information Processing Systems*, 33, 9459-9474.

[^3]: Liu, N. F., Lin, K., Hewitt, J., et al. (2023). "Lost in the Middle: How Language Models Use Long Contexts." *arXiv preprint arXiv:2307.03172*.

[^4]: Reimers, N., & Gurevych, I. (2019). "Sentence-BERT: Sentence Embeddings using Siamese BERT-Networks." *EMNLP-IJCNLP 2019*, 3982-3992.

[^5]: Malkov, Y. A., & Yashunin, D. A. (2018). "Efficient and robust approximate nearest neighbor search using Hierarchical Navigable Small World graphs." *IEEE Transactions on Pattern Analysis and Machine Intelligence*, 42(4), 824-836.

[^6]: Khattab, O., & Zaharia, M. (2020). "ColBERT: Efficient and Effective Passage Search via Contextualized Late Interaction over BERT." *SIGIR 2020*, 39-48.

[^7]: Robertson, S. E., & Sparck Jones, K. (1976). "Relevance weighting of search terms." *Journal of the American Society for Information Science*, 27(3), 129-146.

[^8]: Petroni, F., RocktÃ¤schel, T., Riedel, S., et al. (2019). "Language Models as Knowledge Bases?" *EMNLP-IJCNLP 2019*, 2463-2473.

[^9]: Khattab, O., Santhanam, K., Li, X. L., et al. (2021). "Demonstrate-Search-Predict: Composing Retrieval and Language Models for Knowledge-Intensive NLP." *arXiv preprint arXiv:2212.14024*.

[^10]: Gao, L., Ma, X., Lin, J., & Callan, J. (2022). "Precise Zero-Shot Dense Retrieval without Relevance Labels." *arXiv preprint arXiv:2212.10496*.

---

**ç‰ˆæ¬Šè²æ˜**: æœ¬æ•™æåŸºæ–¼é–‹æºç ”ç©¶æˆæœç·¨å¯«ï¼Œéµå¾ªå­¸è¡“å…±äº«åŸå‰‡ã€‚å¼•ç”¨è«‹è¨»æ˜å‡ºè™•ã€‚

**èª²ç¨‹è©•ä¼°**: æœ¬ç« å…§å®¹å°‡åœ¨æœŸä¸­è€ƒè©¦ä¸­å 20%æ¬Šé‡ï¼Œé‡é»è€ƒæŸ¥ç†è«–ç†è§£å’Œåˆ†æèƒ½åŠ›ã€‚